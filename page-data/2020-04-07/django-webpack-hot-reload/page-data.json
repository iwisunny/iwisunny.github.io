{"componentChunkName":"component---src-templates-blog-post-js","path":"/2020-04-07/django-webpack-hot-reload","result":{"data":{"site":{"siteMetadata":{"title":"WangXi","author":"sunnywang"}},"markdownRemark":{"id":"74b5fa13-8997-59a3-b076-9f6d3517bea8","excerpt":"1. 设置后端环境 2. 设置 django 的 settings.py 3. 设置 webpack (开发环境) 4. django 模板 实际项目中的演示： django webpack热加载","html":"<h2>1. 设置后端环境</h2>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token comment\"># init python virtrual env</span>\npip <span class=\"token function\">install</span> virtualenv\nvirtualenv venv\n<span class=\"token builtin class-name\">source</span> ./venv/bin/activate\n\npip <span class=\"token function\">install</span> django-webpack-loader</code></pre></div>\n<h2>2. 设置 django 的 settings.py</h2>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">WEBPACK_LOADER <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">'DEFAULT'</span><span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string\">'CACHE'</span><span class=\"token builtin class-name\">:</span> not DEBUG,\n        <span class=\"token string\">'BUNDLE_DIR_NAME'</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">'dist/'</span>, <span class=\"token comment\"># must end with slash</span>\n        <span class=\"token string\">'STATS_FILE'</span><span class=\"token builtin class-name\">:</span> os.path.join<span class=\"token punctuation\">(</span>BASE_DIR, <span class=\"token string\">'static/dist/webpack-stats.json'</span><span class=\"token punctuation\">)</span>,\n        <span class=\"token string\">'POLL_INTERVAL'</span><span class=\"token builtin class-name\">:</span> <span class=\"token number\">0.1</span>,\n        <span class=\"token string\">'TIMEOUT'</span><span class=\"token builtin class-name\">:</span> None,\n        <span class=\"token string\">'IGNORE'</span><span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'.+\\.hot-update.js'</span>, <span class=\"token string\">'.+\\.map'</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2>3. 设置 webpack (开发环境)</h2>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">const path <span class=\"token operator\">=</span> require<span class=\"token punctuation\">(</span><span class=\"token string\">'path'</span><span class=\"token punctuation\">)</span>\nconst webpackNotifier <span class=\"token operator\">=</span> require<span class=\"token punctuation\">(</span><span class=\"token string\">'webpack-notifier'</span><span class=\"token punctuation\">)</span>\nconst ManifestPlugin <span class=\"token operator\">=</span> require<span class=\"token punctuation\">(</span><span class=\"token string\">'webpack-manifest-plugin'</span><span class=\"token punctuation\">)</span>\nconst BundleTracker <span class=\"token operator\">=</span> require<span class=\"token punctuation\">(</span><span class=\"token string\">'webpack-bundle-tracker'</span><span class=\"token punctuation\">)</span>\n\nconst devServerPort <span class=\"token operator\">=</span> process.env.DEV_SERVER_PORT <span class=\"token operator\">||</span> <span class=\"token number\">9000</span>\n\nmodule.exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  mode: <span class=\"token string\">'development'</span>,\n  devtool: <span class=\"token string\">'cheap-module-eval-source-map'</span>,\n  entry: <span class=\"token string\">'./src/index.js'</span>,\n  output: <span class=\"token punctuation\">{</span>\n    path: path.resolve<span class=\"token punctuation\">(</span>__dirname, <span class=\"token string\">'static/dist'</span><span class=\"token punctuation\">)</span>,\n    filename: <span class=\"token string\">'[name].js'</span>,\n    chunkFilename: <span class=\"token string\">'[name].chunk.js'</span>,\n\n    // <span class=\"token keyword\">if</span> you want hmr, point to webpack-dev-server path, not django static <span class=\"token function\">file</span>\n    publicPath: <span class=\"token variable\"><span class=\"token variable\">`</span>http://localhost:$<span class=\"token punctuation\">{</span>devServerPort<span class=\"token punctuation\">}</span>/static/dist/<span class=\"token variable\">`</span></span>\n  <span class=\"token punctuation\">}</span>,\n  devServer: <span class=\"token punctuation\">{</span>\n    contentBase: path.resolve<span class=\"token punctuation\">(</span>__dirname, <span class=\"token string\">'static/dist'</span><span class=\"token punctuation\">)</span>,\n    compress: true,\n    port: process.env.DEV_SERVER_PORT <span class=\"token operator\">||</span> <span class=\"token number\">9000</span>,\n    headers: <span class=\"token punctuation\">{</span>\n      <span class=\"token string\">'Access-Control-Allow-Origin'</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">'*'</span>\n    <span class=\"token punctuation\">}</span>,\n    historyApiFallback: true,\n\n    // HMR\n    hotOnly: true,\n    inline: true,\n    clientLogLevel: <span class=\"token string\">'warn'</span>\n  <span class=\"token punctuation\">}</span>,\n  plugins: <span class=\"token punctuation\">[</span>\n    new ManifestPlugin<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      publicPath: <span class=\"token string\">'static/dist/'</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>,\n    new BundleTracker<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      filename: <span class=\"token string\">'./static/dist/webpack-stats.json'</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2>4. django 模板</h2>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\">{% load custom_tags %} {% load render_bundle from webpack_loader %}\n<span class=\"token doctype\">&lt;!DOCTYPE html></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span> <span class=\"token attr-name\">lang</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>{{ site.lang|default:'zh-cn' }}<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">charset</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>utf-8<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span>\n      <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>viewport<span class=\"token punctuation\">\"</span></span>\n      <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>width=device-width, initial-scale=1, shrink-to-fit=no<span class=\"token punctuation\">\"</span></span>\n    <span class=\"token punctuation\">/></span></span>\n\n    {% block styles %} {% if is_prod %}\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>stylesheet<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>{{ 'styles.css' | get_manifest_asset }}<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n    {% endif %} {% endblock %}\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>\n    {% block content %}\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>app<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    {% endblock %} {% block scripts %} {% if is_prod %}\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>{{ 'styles.js' | get_manifest_asset }}<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>{{ 'main.js' | get_manifest_asset }}<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n    {% else %} {% render_bundle 'main' %} {% endif %} {% endblock %}\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<h3>实际项目中的演示：</h3>\n<p><img src=\"/images/django-webpack-hot-reload.jpg\" alt=\"django webpack热加载\"></p>","frontmatter":{"title":"django webpack hot reload","date":"April 07, 2020","description":"django作为后端的webpack热加载的一种实现"}}},"pageContext":{"slug":"/2020-04-07/django-webpack-hot-reload","previous":{"fields":{"slug":"/2020-04-06/mac-catalina-install-libvips"},"frontmatter":{"title":"Mac 10.15 安装 libvips"}},"next":{"fields":{"slug":"/2020-04-07/note-about-npmrc"},"frontmatter":{"title":"npmrc常用配置"}}}}}